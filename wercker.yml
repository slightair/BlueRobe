box: slightair/android

build:
  steps:
    - script:
        name: show base information
        code: |
          ./gradlew -v
          echo $ANDROID_HOME
          echo $ANDROID_SDK_VERSION
          echo $ANDROID_BUILD_TOOLS
          echo $ANDROID_UPDATE_FILTER
          echo $ANDROID_NDK_HOME
    - android-sdk-update:
        filter: platform-tools,build-tools-21.1.1,android-21,sys-img-armeabi-v7a-android-19,extra-android-m2repository,extra-google-m2repository
    - script:
        name: build
        code: |
          ./gradlew --full-stacktrace -q --project-cache-dir=$WERCKER_CACHE_DIR android:assembleRelease
  after-steps:
    - script:
        name: inspect build result
        code: |
          ls -la android/build/outputs/apk/
          cp android/build/outputs/apk/*.apk $WERCKER_REPORT_ARTIFACTS_DIR
deploy:
  steps:
    - script:
        name: upload to deploygate
        code: |
          curl -F file=@android/build/outputs/apk/android-release-unsigned.apk -F token="$DEPLOYGATE_API_KEY" -F message="build: $WERCKER_GIT_COMMIT" https://deploygate.com/api/users/slightair/apps
